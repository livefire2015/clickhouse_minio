CREATE TABLE default.factTable_plain
(
    `index` Int64,
    `int0` Int64,
    `int1` Int64,
    `int2` Int64,
    `int3` Int64,
    `int4` Int64,
    `int5` Int64,
    `int6` Int64,
    `int7` Int64,
    `int8` Int64,
    `int9` Int64,
    `int10` Int64,
    `int11` Int64,
    `int12` Int64,
    `int13` Int64,
    `int14` Int64,
    `int15` Int64,
    `int16` Int64,
    `int17` Int64,
    `int18` Int64,
    `int19` Int64,
    `int20` Int64,
    `int21` Int64,
    `int22` Int64,
    `int23` Int64,
    `int24` Int64,
    `int25` Int64,
    `int26` Int64,
    `int27` Int64,
    `int28` Int64,
    `int29` Int64,
    `int30` Int64,
    `int31` Int64,
    `int32` Int64,
    `int33` Int64,
    `dttime0` DateTime,
    `dttime1` DateTime,
    `dttime2` DateTime,
    `dttime3` DateTime,
    `dttime4` DateTime,
    `dttime5` DateTime,
    `dttime6` DateTime,
    `dttime7` DateTime,
    `dttime8` DateTime,
    `dttime9` DateTime,
    `dttime10` DateTime,
    `dttime11` DateTime,
    `dttime12` DateTime,
    `dttime13` DateTime,
    `dttime14` DateTime,
    `dttime15` DateTime,
    `dttime16` DateTime,
    `dttime17` DateTime,
    `dttime18` DateTime,
    `dttime19` DateTime,
    `dttime20` DateTime,
    `dttime21` DateTime,
    `dttime22` DateTime,
    `dttime23` DateTime,
    `dttime24` DateTime,
    `dttime25` DateTime,
    `dttime26` DateTime,
    `dttime27` DateTime,
    `dttime28` DateTime,
    `dttime29` DateTime,
    `dttime30` DateTime,
    `dttime31` DateTime,
    `dttime32` DateTime,
    `str0` String,
    `str1` String,
    `str2` String,
    `str3` String,
    `str4` String,
    `str5` String,
    `str6` String,
    `str7` String,
    `str8` String,
    `str9` String,
    `str10` String,
    `str11` String,
    `str12` String,
    `str13` String,
    `str14` String,
    `str15` String,
    `str16` String,
    `str17` String,
    `str18` String,
    `str19` String,
    `str20` String,
    `str21` String,
    `str22` String,
    `str23` String,
    `str24` String,
    `str25` String,
    `str26` String,
    `str27` String,
    `str28` String,
    `str29` String,
    `str30` String,
    `str31` String,
    `str32` String,
    `partition` Int64,
    `val` Float32,
    `position` UInt16
)
ENGINE = MergeTree()
PARTITION BY partition
PRIMARY KEY tuple()
ORDER BY (int0, int1, int2, int3, int4, int5, int6, int7, int8, int9, int10, int11, int12, int13, int14, int15, int16, int17, int18, int19, int20, int21, int22, int23, int24, int25, int26, int27, int28, int29, int30, int31, int32, int33, dttime0, dttime1, dttime2, dttime3, dttime4, dttime5, dttime6, dttime7, dttime8, dttime9, dttime10, dttime11, dttime12, dttime13, dttime14, dttime15, dttime16, dttime17, dttime18, dttime19, dttime20, dttime21, dttime22, dttime23, dttime24, dttime25, dttime26, dttime27, dttime28, dttime29, dttime30, dttime31, dttime32, str0, str1, str2, str3, str4, str5, str6, str7, str8, str9, str10, str11, str12, str13, str14, str15, str16, str17, str18, str19, str20, str21, str22, str23, str24, str25, str26, str27, str28, str29, str30, str31, str32, position)
SETTINGS index_granularity = 8192;

/* This one was slow, and we had to iterate by partition */
insert into factTable_plain
SELECT `index`,
int0,int1,int2,int3,int4,int5,int6,int7,int8,int9,int10,int11,int12,int13,int14,int15,int16,int17,int18,int19,int20,int21,int22,int23,int24,int25,int26,int27,int28,int29,int30,int31,int32,int33,dttime0,dttime1,dttime2,dttime3,dttime4,dttime5,dttime6,dttime7,dttime8,dttime9,dttime10,dttime11,dttime12,dttime13,dttime14,dttime15,dttime16,dttime17,dttime18,dttime19,dttime20,dttime21,dttime22,dttime23,dttime24,dttime25,dttime26,dttime27,dttime28,dttime29,dttime30,dttime31,dttime32,str0,str1,str2,str3,str4,str5,str6,str7,str8,str9,str10,str11,str12,str13,str14,str15,str16,str17,str18,str19,str20,str21,str22,str23,str24,str25,str26,str27,str28,str29,str30,str31,str32,
`partition`,
value, position
FROM factTable
ARRAY JOIN arrFloat as value, arrayEnumerate(arrFloat) as position;

/* The rest are some experiments with the storage and compressin */

/* LowCardinality version */ 

CREATE TABLE default.factTable_plain2
(
    `index` Int64 Codec(T64, LZ4),
    `int0` Int64 Codec(T64, LZ4),
    `int1` Int64 Codec(T64, LZ4),
    `int2` Int64 Codec(T64, LZ4),
    `int3` Int64 Codec(T64, LZ4),
    `int4` Int64 Codec(T64, LZ4),
    `int5` Int64 Codec(T64, LZ4),
    `int6` Int64 Codec(T64, LZ4),
    `int7` Int64 Codec(T64, LZ4),
    `int8` Int64 Codec(T64, LZ4),
    `int9` Int64 Codec(T64, LZ4),
    `int10` Int64 Codec(T64, LZ4),
    `int11` Int64 Codec(T64, LZ4),
    `int12` Int64 Codec(T64, LZ4),
    `int13` Int64 Codec(T64, LZ4),
    `int14` Int64 Codec(T64, LZ4),
    `int15` Int64 Codec(T64, LZ4),
    `int16` Int64 Codec(T64, LZ4),
    `int17` Int64 Codec(T64, LZ4),
    `int18` Int64 Codec(T64, LZ4),
    `int19` Int64 Codec(T64, LZ4),
    `int20` Int64 Codec(T64, LZ4),
    `int21` Int64 Codec(T64, LZ4),
    `int22` Int64 Codec(T64, LZ4),
    `int23` Int64 Codec(T64, LZ4),
    `int24` Int64 Codec(T64, LZ4),
    `int25` Int64 Codec(T64, LZ4),
    `int26` Int64 Codec(T64, LZ4),
    `int27` Int64 Codec(T64, LZ4),
    `int28` Int64 Codec(T64, LZ4),
    `int29` Int64 Codec(T64, LZ4),
    `int30` Int64 Codec(T64, LZ4),
    `int31` Int64 Codec(T64, LZ4),
    `int32` Int64 Codec(T64, LZ4),
    `int33` Int64 Codec(T64, LZ4),
    `dttime0` DateTime,
    `dttime1` DateTime,
    `dttime2` DateTime,
    `dttime3` DateTime,
    `dttime4` DateTime,
    `dttime5` DateTime,
    `dttime6` DateTime,
    `dttime7` DateTime,
    `dttime8` DateTime,
    `dttime9` DateTime,
    `dttime10` DateTime,
    `dttime11` DateTime,
    `dttime12` DateTime,
    `dttime13` DateTime,
    `dttime14` DateTime,
    `dttime15` DateTime,
    `dttime16` DateTime,
    `dttime17` DateTime,
    `dttime18` DateTime,
    `dttime19` DateTime,
    `dttime20` DateTime,
    `dttime21` DateTime,
    `dttime22` DateTime,
    `dttime23` DateTime,
    `dttime24` DateTime,
    `dttime25` DateTime,
    `dttime26` DateTime,
    `dttime27` DateTime,
    `dttime28` DateTime,
    `dttime29` DateTime,
    `dttime30` DateTime,
    `dttime31` DateTime,
    `dttime32` DateTime,
    `str0` LowCardinality(String),
    `str1` LowCardinality(String),
    `str2` LowCardinality(String),
    `str3` LowCardinality(String),
    `str4` LowCardinality(String),
    `str5` LowCardinality(String),
    `str6` LowCardinality(String),
    `str7` LowCardinality(String),
    `str8` LowCardinality(String),
    `str9` LowCardinality(String),
    `str10` LowCardinality(String),
    `str11` LowCardinality(String),
    `str12` LowCardinality(String),
    `str13` LowCardinality(String),
    `str14` LowCardinality(String),
    `str15` LowCardinality(String),
    `str16` LowCardinality(String),
    `str17` LowCardinality(String),
    `str18` LowCardinality(String),
    `str19` LowCardinality(String),
    `str20` LowCardinality(String),
    `str21` LowCardinality(String),
    `str22` LowCardinality(String),
    `str23` LowCardinality(String),
    `str24` LowCardinality(String),
    `str25` LowCardinality(String),
    `str26` LowCardinality(String),
    `str27` LowCardinality(String),
    `str28` LowCardinality(String),
    `str29` LowCardinality(String),
    `str30` LowCardinality(String),
    `str31` LowCardinality(String),
    `str32` LowCardinality(String),
    `partition` Int64 Codec(T64, LZ4),
    `value` Float32,
    `position` UInt16 Codec(Delta, LZ4)
)
ENGINE = MergeTree()
PARTITION BY partition
PRIMARY KEY tuple()
ORDER BY (position)
SETTINGS index_granularity = 8192;

INSERT INTO factTable_plain2 SELECT *
FROM factTable_plain

Ok.

0 rows in set. Elapsed: 457.395 sec. Processed 1.72 billion rows, 1.88 TB (3.76 million rows/s., 4.11 GB/s.) 

CREATE TABLE default.factTable_plain3
(
    `index` Int64 Codec(T64, LZ4),
    `int0` Int64 Codec(T64, LZ4),
    `int1` Int64 Codec(T64, LZ4),
    `int2` Int64 Codec(T64, LZ4),
    `int3` Int64 Codec(T64, LZ4),
    `int4` Int64 Codec(T64, LZ4),
    `int5` Int64 Codec(T64, LZ4),
    `int6` Int64 Codec(T64, LZ4),
    `int7` Int64 Codec(T64, LZ4),
    `int8` Int64 Codec(T64, LZ4),
    `int9` Int64 Codec(T64, LZ4),
    `int10` Int64 Codec(T64, LZ4),
    `int11` Int64 Codec(T64, LZ4),
    `int12` Int64 Codec(T64, LZ4),
    `int13` Int64 Codec(T64, LZ4),
    `int14` Int64 Codec(T64, LZ4),
    `int15` Int64 Codec(T64, LZ4),
    `int16` Int64 Codec(T64, LZ4),
    `int17` Int64 Codec(T64, LZ4),
    `int18` Int64 Codec(T64, LZ4),
    `int19` Int64 Codec(T64, LZ4),
    `int20` Int64 Codec(T64, LZ4),
    `int21` Int64 Codec(T64, LZ4),
    `int22` Int64 Codec(T64, LZ4),
    `int23` Int64 Codec(T64, LZ4),
    `int24` Int64 Codec(T64, LZ4),
    `int25` Int64 Codec(T64, LZ4),
    `int26` Int64 Codec(T64, LZ4),
    `int27` Int64 Codec(T64, LZ4),
    `int28` Int64 Codec(T64, LZ4),
    `int29` Int64 Codec(T64, LZ4),
    `int30` Int64 Codec(T64, LZ4),
    `int31` Int64 Codec(T64, LZ4),
    `int32` Int64 Codec(T64, LZ4),
    `int33` Int64 Codec(T64, LZ4),
    `dttime0` DateTime,
    `dttime1` DateTime,
    `dttime2` DateTime,
    `dttime3` DateTime,
    `dttime4` DateTime,
    `dttime5` DateTime,
    `dttime6` DateTime,
    `dttime7` DateTime,
    `dttime8` DateTime,
    `dttime9` DateTime,
    `dttime10` DateTime,
    `dttime11` DateTime,
    `dttime12` DateTime,
    `dttime13` DateTime,
    `dttime14` DateTime,
    `dttime15` DateTime,
    `dttime16` DateTime,
    `dttime17` DateTime,
    `dttime18` DateTime,
    `dttime19` DateTime,
    `dttime20` DateTime,
    `dttime21` DateTime,
    `dttime22` DateTime,
    `dttime23` DateTime,
    `dttime24` DateTime,
    `dttime25` DateTime,
    `dttime26` DateTime,
    `dttime27` DateTime,
    `dttime28` DateTime,
    `dttime29` DateTime,
    `dttime30` DateTime,
    `dttime31` DateTime,
    `dttime32` DateTime,
    `str0` LowCardinality(String),
    `str1` LowCardinality(String),
    `str2` LowCardinality(String),
    `str3` LowCardinality(String),
    `str4` LowCardinality(String),
    `str5` LowCardinality(String),
    `str6` LowCardinality(String),
    `str7` LowCardinality(String),
    `str8` LowCardinality(String),
    `str9` LowCardinality(String),
    `str10` LowCardinality(String),
    `str11` LowCardinality(String),
    `str12` LowCardinality(String),
    `str13` LowCardinality(String),
    `str14` LowCardinality(String),
    `str15` LowCardinality(String),
    `str16` LowCardinality(String),
    `str17` LowCardinality(String),
    `str18` LowCardinality(String),
    `str19` LowCardinality(String),
    `str20` LowCardinality(String),
    `str21` LowCardinality(String),
    `str22` LowCardinality(String),
    `str23` LowCardinality(String),
    `str24` LowCardinality(String),
    `str25` LowCardinality(String),
    `str26` LowCardinality(String),
    `str27` LowCardinality(String),
    `str28` LowCardinality(String),
    `str29` LowCardinality(String),
    `str30` LowCardinality(String),
    `str31` LowCardinality(String),
    `str32` LowCardinality(String),
    `partition` Int64 Codec(T64, LZ4),
    `value` Float32,
    `position` UInt16 Codec(Delta, LZ4)
)
ENGINE = MergeTree()
PARTITION BY partition
PRIMARY KEY tuple()
ORDER BY (int0, int1, int2, int3, int4, int5, int6, int7, int8, int9, int10, int11, int12, int13, int14, int15, int16, int17, int18, int19, int20, int21, int22, int23, int24, int25, int26, int27, int28, int29, int30, int31, int32, int33, dttime0, dttime1, dttime2, dttime3, dttime4, dttime5, dttime6, dttime7, dttime8, dttime9, dttime10, dttime11, dttime12, dttime13, dttime14, dttime15, dttime16, dttime17, dttime18, dttime19, dttime20, dttime21, dttime22, dttime23, dttime24, dttime25, dttime26, dttime27, dttime28, dttime29, dttime30, dttime31, dttime32, str0, str1, str2, str3, str4, str5, str6, str7, str8, str9, str10, str11, str12, str13, str14, str15, str16, str17, str18, str19, str20, str21, str22, str23, str24, str25, str26, str27, str28, str29, str30, str31, str32, position)
SETTINGS index_granularity = 8192;

0 rows in set. Elapsed: 579.696 sec. Processed 1.72 billion rows, 1.88 TB (2.97 million rows/s., 3.24 GB/s.)

SELECT 
    table,
    sum(rows),
    sum(data_uncompressed_bytes) AS uc,
    sum(data_compressed_bytes) AS c,
    uc / c AS ratio,
    formatReadableSize(c) AS size,
    count() AS parts
FROM system.parts
WHERE active AND (table LIKE 'factTable_plain%')
GROUP BY table
ORDER BY table ASC

┌─table────────────┬──sum(rows)─┬────────────uc─┬────────────c─┬──────────────ratio─┬─size───────┬─parts─┐
│ factTable_plain  │ 1720000000 │ 1423552324000 │  14839550571 │  95.92961169470716 │ 13.82 GiB  │    66 │
│ factTable_plain2 │ 1720000000 │  789623643930 │ 342509602608 │ 2.3054058569964213 │ 318.99 GiB │   116 │
│ factTable_plain3 │ 1720000000 │  789606048787 │  25122106302 │  31.43072636087598 │ 23.40 GiB  │   106 │
└──────────────────┴────────────┴───────────────┴──────────────┴────────────────────┴────────────┴───────┘
